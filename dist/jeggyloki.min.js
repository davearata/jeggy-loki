function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_get=function(e,t,n){for(var r=!0;r;){var i=e,o=t,u=n;a=s=c=void 0,r=!1,null===i&&(i=Function.prototype);var a=Object.getOwnPropertyDescriptor(i,o);if(void 0!==a){if("value"in a)return a.value;var c=a.get;return void 0===c?void 0:c.call(u)}var s=Object.getPrototypeOf(i);if(null===s)return void 0;e=s,t=o,n=u,r=!0}};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("jeggy"),require("lodash"),require("co"),require("lokijs")):"function"==typeof define&&define.amd?define(["exports","jeggy","lodash","co","lokijs"],t):t(e.jeggyloki={},e.jeggy,e._,e.co,e.Loki)}(this,function(e,t,n,r,i){"use strict";n="default"in n?n["default"]:n,r="default"in r?r["default"]:r,i="default"in i?i["default"]:i;var o=function(e){if(n.keys(e).length>1){var t=n.map(n.keys(e),function(t){var n={};return n[t]=e[t],n});e={$and:t}}return e},u=function(e,t){var n={};return n[e]=t,n},a=function(e,t){var r={},i=t.split(" ");return n.includes(t,"-")?(r=n.assign(r,e),n.each(i,function(e){n.includes(e,"-")&&(e=n.trim(e,"-"),r=n.omit(r,e))})):n.each(i,function(t){n.includes(t,"+")&&(t=n.trim(t,"+")),r[t]=e[t]}),r},c=function(e){function t(e,n,r){if(_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),!n)throw new Error("a LokiCollection must be intiialized with a native lokiJS collection");this.nativeLokiCollection=n,this.idKey=r||"_id"}return _inherits(t,e),_createClass(t,[{key:"find",value:function(e,t){var i=this.nativeLokiCollection;return r(regeneratorRuntime.mark(function u(){var r;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return e=o(e),n.isUndefined(e)&&(e={}),r=i.find(e),null!==r&&(r=n.clone(r,!0),n.isString(t)&&(r=n.map(r,function(e){return a(e,t)}))),u.abrupt("return",r);case 5:case"end":return u.stop()}},u,this)}))}},{key:"findOne",value:function(e,t){var i=this.nativeLokiCollection;return r(regeneratorRuntime.mark(function u(){var r;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(e=o(e),n.isUndefined(e)&&(e={}),r=i.find(e),null!==r&&!n.isEmpty(r)){u.next=5;break}return u.abrupt("return",null);case 5:return n.isArray(r)&&(r=r[0]),r=n.assign({},r),n.isString(t)&&n.isObject(r)&&(r=a(r,t)),u.abrupt("return",r);case 9:case"end":return u.stop()}},u,this)}))}},{key:"findById",value:function(e,t){var n=u(this.idKey,e);return this.findOne(n,t)}},{key:"create",value:function(e){var t=this.nativeLokiCollection;return r(regeneratorRuntime.mark(function i(){var r;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(r=t.insert(e),null!==r){i.next=3;break}return i.abrupt("return",r);case 3:return i.abrupt("return",n.assign({},r));case 4:case"end":return i.stop()}},i,this)}))}},{key:"removeWhere",value:function(e){var t=this.nativeLokiCollection;return r(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=o(e),n.abrupt("return",t.removeWhere(e));case 2:case"end":return n.stop()}},n,this)}))}},{key:"remove",value:function(e){var t=this.nativeLokiCollection,i=u(this.idKey,e[this.idKey]);return r(regeneratorRuntime.mark(function o(){var r;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r=n.assign({},t.findOne(i)),!n.isEmpty(r)){o.next=3;break}throw new Error("unknown doc id:"+e.id);case 3:return o.abrupt("return",t.remove(e));case 4:case"end":return o.stop()}},o,this)}))}},{key:"update",value:function(e){var t=this.nativeLokiCollection,r=u(this.idKey,e[this.idKey]);return this.findOne(r).then(function(r){if(n.isEmpty(r))throw new Error("unknown doc id:"+e.id);return r=n.merge(r,e),t.update(r),n.assign({},r)})}}]),t}(t.Collection);e.LokiCollection=c;var s=function(e,t,r){var i=e[t];if(n.isUndefined(i))throw new Error("Unknown field: "+t);return r.findById(i).then(function(n){if(!n)throw new Error("population  failed");e[t]=n})},l=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),n.isString(e)&&(e=new i(e)),this.loki=e,this.collections={}}return _inherits(t,e),_createClass(t,[{key:"addCollection",value:function(e,t){var r=void 0;if(e instanceof c)r=e,e=r.name;else{if(!n.isString(e)||n.isEmpty(e))throw new Error("must provide a name when adding a collection");var i=this.loki.addCollection(e);r=new c(e,i,t)}return this.collections[e]=r,r}},{key:"getCollection",value:function(e){if(!this.collections[e])throw new Error("unknown collection: "+e);return this.collections[e]}},{key:"getCollections",value:function(){return this.collections}},{key:"populate",value:function(e,t,i){var o=this.getCollection.bind(this);return r(regeneratorRuntime.mark(function u(){var r,a;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(e){u.next=2;break}throw new Error("tried to populate a null value");case 2:return r=o(i),n.isArray(e)||(e=[e]),a=n.map(e,function(e){return s(e,t,r)}),u.abrupt("return",Promise.all(a).then(function(){return e}));case 6:case"end":return u.stop()}},u,this)}))}}]),t}(t.Adapter);e.LokiAdapter=l,require("babel/polyfill")});
//# sourceMappingURL=jeggyloki.min.js.map
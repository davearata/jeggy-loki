function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get=function(e,t,r){for(var n=!0;n;){var i=e,o=t,a=r;u=s=c=void 0,n=!1,null===i&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,o);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(a)}var s=Object.getPrototypeOf(i);if(null===s)return void 0;e=s,t=o,r=a,n=!0}};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("jeggy"),require("lodash"),require("co"),require("lokijs")):"function"==typeof define&&define.amd?define(["exports","jeggy","lodash","co","lokijs"],t):t(e.jeggyloki={},e.jeggy,e._,e.co,e.Loki)}(this,function(e,t,r,n,i){"use strict";r="default"in r?r["default"]:r,n="default"in n?n["default"]:n,i="default"in i?i["default"]:i;var o=function(e){if(r.keys(e).length>1){var t=r.map(r.keys(e),function(t){var r={};return r[t]=e[t],r});e={$and:t}}return e},a=function(e,t){var r={};return r[e]=t,r},u=function(e,t){var n={},i=t.split(" ");return r.includes(t,"-")?(n=r.assign(n,e),r.each(i,function(e){r.includes(e,"-")&&(e=r.trim(e,"-"),n=r.omit(n,e))})):r.each(i,function(t){r.includes(t,"+")&&(t=r.trim(t,"+")),n[t]=e[t]}),n},c=function(e){function t(e,r,n){if(_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),!r)throw new Error("a LokiCollection must be intiialized with a native lokiJS collection");this.nativeLokiCollection=r,this.idKey=n||"_id"}return _inherits(t,e),_createClass(t,[{key:"find",value:function(e){var t=this.nativeLokiCollection;return n(regeneratorRuntime.mark(function i(){var n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e=o(e),r.isUndefined(e)&&(e={}),n=t.find(e),null!==n){i.next=5;break}return i.abrupt("return",n);case 5:return i.abrupt("return",r.clone(n,!0));case 6:case"end":return i.stop()}},i,this)}))}},{key:"findOne",value:function(e,t){var i=this.nativeLokiCollection;return n(regeneratorRuntime.mark(function a(){var n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=o(e),r.isUndefined(e)&&(e={}),n=i.find(e),null!==n&&!r.isEmpty(n)){a.next=5;break}return a.abrupt("return",null);case 5:return r.isArray(n)&&(n=n[0]),n=r.assign({},n),r.isString(t)&&r.isObject(n)&&(n=u(n,t)),a.abrupt("return",n);case 9:case"end":return a.stop()}},a,this)}))}},{key:"findById",value:function(e,t){var r=a(this.idKey,e);return this.findOne(r,t)}},{key:"create",value:function(e){var t=this.nativeLokiCollection;return n(regeneratorRuntime.mark(function i(){var n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(n=t.insert(e),null!==n){i.next=3;break}return i.abrupt("return",n);case 3:return i.abrupt("return",r.assign({},n));case 4:case"end":return i.stop()}},i,this)}))}},{key:"removeWhere",value:function(e){var t=this.nativeLokiCollection;return n(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e=o(e),r.abrupt("return",t.removeWhere(e));case 2:case"end":return r.stop()}},r,this)}))}},{key:"remove",value:function(e){var t=this.nativeLokiCollection,i=a(this.idKey,e[this.idKey]);return n(regeneratorRuntime.mark(function o(){var n;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(n=r.assign({},t.findOne(i)),!r.isEmpty(n)){o.next=3;break}throw new Error("unknown doc id:"+e.id);case 3:return o.abrupt("return",t.remove(e));case 4:case"end":return o.stop()}},o,this)}))}},{key:"update",value:function(e){var t=this.nativeLokiCollection,i=a(this.idKey,e[this.idKey]);return n(regeneratorRuntime.mark(function o(){var n;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(n=r.assign({},t.findOne(i)),!r.isEmpty(n)){o.next=3;break}throw new Error("unknown doc id:"+e.id);case 3:return n=r.merge(n,e),o.abrupt("return",r.assign({},t.update(n)));case 5:case"end":return o.stop()}},o,this)}))}}]),t}(t.Collection);e.LokiCollection=c;var s=function(e,t,n){var i=e[t];if(r.isUndefined(i))throw new Error("Unknown field: "+t);return n.findById(i).then(function(r){if(!r)throw new Error("population  failed");e[t]=r})},l=function(e){function t(e){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),r.isString(e)&&(e=new i(e)),this.loki=e,this.collections={}}return _inherits(t,e),_createClass(t,[{key:"addCollection",value:function(e,t){var n=void 0;if(e instanceof c)n=e,e=n.name;else{if(!r.isString(e)||r.isEmpty(e))throw new Error("must provide a name when adding a collection");var i=this.loki.addCollection(e);n=new c(e,i,t)}return this.collections[e]=n,n}},{key:"getCollection",value:function(e){if(!this.collections[e])throw new Error("unknown collection: "+e);return this.collections[e]}},{key:"getCollections",value:function(){return this.collections}},{key:"populate",value:function(e,t,i){var o=this.getCollection.bind(this);return n(regeneratorRuntime.mark(function a(){var n,u;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e){a.next=2;break}throw new Error("tried to populate a null value");case 2:return n=o(i),r.isArray(e)||(e=[e]),u=r.map(e,function(e){return s(e,t,n)}),a.abrupt("return",Promise.all(u).then(function(){return e}));case 6:case"end":return a.stop()}},a,this)}))}}]),t}(t.Adapter);e.LokiAdapter=l,require("babel/polyfill")});
//# sourceMappingURL=jeggyloki.min.js.map